table:
  name: users
  schema: public
configuration:
  column_config:
    clerk_user_id:
      custom_name: clerkUserId
    created_at:
      custom_name: createdAt
    deactivated_at:
      custom_name: deactivatedAt
    deactivated_by:
      custom_name: deactivatedBy
    default_admin_time_percentage:
      custom_name: defaultAdminTimePercentage
    is_active:
      custom_name: isActive
    is_staff:
      custom_name: isStaff
    manager_id:
      custom_name: managerId
    position:
      custom_name: position
    updated_at:
      custom_name: updatedAt
  custom_column_names:
    clerk_user_id: clerkUserId
    created_at: createdAt
    deactivated_at: deactivatedAt
    deactivated_by: deactivatedBy
    default_admin_time_percentage: defaultAdminTimePercentage
    is_active: isActive
    is_staff: isStaff
    manager_id: managerId
    position: position
    updated_at: updatedAt
  custom_name: users
  custom_root_fields:
    delete: bulkDeleteUsers
    delete_by_pk: deleteUserById
    insert: bulkInsertUsers
    insert_one: insertUser
    select: users
    select_aggregate: usersAggregate
    select_by_pk: userById
    update: bulkUpdateUsers
    update_by_pk: updateUserById
object_relationships:
  - name: managerUser
    using:
      manual_configuration:
        column_mapping:
          manager_id: id
        insertion_order: null
        remote_table:
          name: users
          schema: public
  - name: statusChangedByUser
    using:
      foreign_key_constraint_on: status_changed_by
array_relationships:
  - name: assignedRoles
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: user_roles
          schema: public
  - name: authoredNotes
    using:
      manual_configuration:
        column_mapping:
          id: user_id
        insertion_order: null
        remote_table:
          name: notes
          schema: public
  - name: backupConsultantPayrolls
    using:
      foreign_key_constraint_on:
        column: backup_consultant_user_id
        table:
          name: payrolls
          schema: public
  - name: billingItems
    using:
      foreign_key_constraint_on:
        column: approved_by
        table:
          name: billing_items
          schema: public
  - name: billingItemsConfirmedBy
    using:
      foreign_key_constraint_on:
        column: confirmed_by
        table:
          name: billing_items
          schema: public
  - name: billingItemsUserId
    using:
      foreign_key_constraint_on:
        column: staff_user_id
        table:
          name: billing_items
          schema: public
  - name: consultantAssignments
    using:
      foreign_key_constraint_on:
        column: consultant_id
        table:
          name: payroll_assignments
          schema: public
  - name: createdAssignmentAudits
    using:
      foreign_key_constraint_on:
        column: changed_by
        table:
          name: payroll_assignment_audit
          schema: public
  - name: createdAssignments
    using:
      foreign_key_constraint_on:
        column: assigned_by
        table:
          name: payroll_assignments
          schema: public
  - name: createdBillingEvents
    using:
      foreign_key_constraint_on:
        column: created_by
        table:
          name: billing_event_log
          schema: public
  - name: createdPermissionOverrides
    using:
      foreign_key_constraint_on:
        column: created_by
        table:
          name: permission_overrides
          schema: public
  - name: dataBackups
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: data_backups
          schema: public
  - name: emailDrafts
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: email_drafts
          schema: public
  - name: emailSendLogs
    using:
      foreign_key_constraint_on:
        column: sender_user_id
        table:
          name: email_send_logs
          schema: public
  - name: emailTemplates
    using:
      foreign_key_constraint_on:
        column: approved_by_user_id
        table:
          name: email_templates
          schema: public
  - name: emailTemplatesCreatedByUserId
    using:
      foreign_key_constraint_on:
        column: created_by_user_id
        table:
          name: email_templates
          schema: public
  - name: managedPayrolls
    using:
      foreign_key_constraint_on:
        column: manager_user_id
        table:
          name: payrolls
          schema: public
  - name: managedTeamMembers
    using:
      foreign_key_constraint_on:
        column: manager_id
        table:
          name: users
          schema: public
  - name: managedUsers
    using:
      manual_configuration:
        column_mapping:
          id: manager_id
        insertion_order: null
        remote_table:
          name: users
          schema: public
  - name: newConsultantAuditTrail
    using:
      foreign_key_constraint_on:
        column: to_consultant_id
        table:
          name: payroll_assignment_audit
          schema: public
  - name: originalConsultantAssignments
    using:
      foreign_key_constraint_on:
        column: original_consultant_id
        table:
          name: payroll_assignments
          schema: public
  - name: originalConsultantAuditTrail
    using:
      foreign_key_constraint_on:
        column: from_consultant_id
        table:
          name: payroll_assignment_audit
          schema: public
  - name: primaryConsultantPayrolls
    using:
      foreign_key_constraint_on:
        column: primary_consultant_user_id
        table:
          name: payrolls
          schema: public
  - name: securitySettings
    using:
      foreign_key_constraint_on:
        column: updated_by
        table:
          name: security_settings
          schema: public
  - name: targetedPermissionAudits
    using:
      foreign_key_constraint_on:
        column: target_user_id
        table:
          name: permission_audit_log
          schema: public
  - name: timeEntries
    using:
      foreign_key_constraint_on:
        column: staff_user_id
        table:
          name: time_entries
          schema: public
  - name: userEmailTemplateFavorites
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: user_email_template_favorites
          schema: public
  - name: userInvitations
    using:
      foreign_key_constraint_on:
        column: revoked_by
        table:
          name: user_invitations
          schema: public
  - name: userInvitationsAcceptedBy
    using:
      foreign_key_constraint_on:
        column: accepted_by
        table:
          name: user_invitations
          schema: public
  - name: userInvitationsInvitedBy
    using:
      foreign_key_constraint_on:
        column: invited_by
        table:
          name: user_invitations
          schema: public
  - name: userInvitationsManagerId
    using:
      foreign_key_constraint_on:
        column: manager_id
        table:
          name: user_invitations
          schema: public
  - name: userLeaveRecords
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: leave
          schema: public
  - name: userPermissionAudits
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: permission_audit_log
          schema: public
  - name: userPermissionOverrides
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: permission_overrides
          schema: public
  - name: userSessions
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: user_sessions
          schema: public
  - name: userSkills
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: user_skills
          schema: public
  - name: userWorkSchedules
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: work_schedule
          schema: public
  - name: usersStatusChangedBy
    using:
      foreign_key_constraint_on:
        column: status_changed_by
        table:
          name: users
          schema: public
insert_permissions:
  - role: developer
    permission:
      check: {}
      columns: '*'
    comment: Developer role has full insert access
  - role: manager
    permission:
      check:
        role:
          _in:
            - viewer
            - consultant
      columns:
        - first_name
        - last_name
        - email
        - username
        - role
        - manager_id
        - is_staff
    comment: Managers can create users with viewer or consultant roles
  - role: org_admin
    permission:
      check: {}
      columns:
        - first_name
        - last_name
        - email
        - username
        - role
        - manager_id
        - is_staff
        - clerk_user_id
    comment: Org admins can create any users
select_permissions:
  - role: ai_assistant
    permission:
      columns:
        - id
        - email
        - role
        - is_active
        - is_staff
        - created_at
        - updated_at
      filter: {}
      allow_aggregations: true
    comment: AI Assistant can view basic user data for analysis (restricted fields only, read-only)
  - role: consultant
    permission:
      columns:
        - clerk_user_id
        - created_at
        - deactivated_at
        - deactivated_by
        - default_admin_time_percentage
        - email
        - id
        - image
        - is_active
        - is_staff
        - manager_id
        - position
        - role
        - updated_at
        - username
      filter:
        _or:
          - id:
              _eq: X-Hasura-User-Id
          - manager_id:
              _eq: X-Hasura-User-Id
          - consultantAssignments:
              consultant_id:
                _eq: X-Hasura-User-Id
          - originalConsultantAssignments:
              original_consultant_id:
                _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: Consultants can view their own profile, their team members, and users from assigned payrolls - no email access for security
  - role: developer
    permission:
      columns: '*'
      filter: {}
      allow_aggregations: true
    comment: Developer role has full system access
  - role: manager
    permission:
      columns:
        - clerk_user_id
        - created_at
        - deactivated_at
        - deactivated_by
        - default_admin_time_percentage
        - email
        - id
        - image
        - is_active
        - is_staff
        - manager_id
        - position
        - role
        - updated_at
        - username
      filter: {}
      allow_aggregations: true
    comment: Managers can view all user details
  - role: org_admin
    permission:
      columns:
        - clerk_user_id
        - created_at
        - deactivated_at
        - deactivated_by
        - default_admin_time_percentage
        - email
        - id
        - image
        - is_active
        - is_staff
        - manager_id
        - position
        - role
        - updated_at
        - username
      filter: {}
      allow_aggregations: true
    comment: Org Admins can view all user data
  - role: viewer
    permission:
      columns:
        - id
        - image
        - is_active
        - position
      filter:
        _or:
          - id:
              _eq: X-Hasura-User-Id
          - is_active:
              _eq: true
    comment: Viewers can only see basic public information about active users and their own profile
update_permissions:
  - role: consultant
    permission:
      columns:
        - email
        - image
        - username
      filter:
        id:
          _eq: X-Hasura-User-Id
      check:
        id:
          _eq: X-Hasura-User-Id
    comment: Users can update their own profile
  - role: developer
    permission:
      columns: '*'
      filter: {}
      check: {}
    comment: Developer role has full update access
  - role: manager
    permission:
      columns:
        - email
        - image
        - username
        - manager_id
        - role
      filter:
        _or:
          - id:
              _eq: X-Hasura-User-Id
          - manager_id:
              _eq: X-Hasura-User-Id
      check:
        _or:
          - id:
              _eq: X-Hasura-User-Id
          - _and:
              - manager_id:
                  _eq: X-Hasura-User-Id
              - role:
                  _in:
                    - viewer
                    - consultant
    comment: Managers can update their profile and their team members
  - role: org_admin
    permission:
      columns:
        - email
        - image
        - username
        - role
        - manager_id
        - is_staff
      filter: {}
      check: {}
    comment: Org admins can update any user
delete_permissions:
  - role: developer
    permission:
      filter: {}
    comment: Developer role has full delete access
  - role: org_admin
    permission:
      filter: {}
    comment: Only Org Admins can delete users
apollo_federation_config:
  enable: v1
