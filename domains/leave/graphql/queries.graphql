# Leave Domain Queries

query GetLeaveRequests(
  $where: leave_bool_exp
  $order_by: [leave_order_by!]
  $limit: Int
  $offset: Int
) {
  leaves(where: $where, order_by: $order_by, limit: $limit, offset: $offset) {
    ...LeaveWithManager
  }
  leavesAggregate(where: $where) {
    aggregate {
      count
    }
  }
}

query GetLeaveRequestById($id: uuid!) {
  leave(id: $id) {
    ...LeaveWithManager
  }
}

query GetLeaveRequestsByUser(
  $userId: uuid!
  $startDate: date
  $endDate: date
) {
  leaves(
    where: {
      _and: [
        { userId: { _eq: $userId } }
        { startDate: { _lte: $endDate } }
        { endDate: { _gte: $startDate } }
      ]
    }
    order_by: { startDate: desc }
  ) {
    ...LeaveCore
  }
}

query GetPendingLeaveRequests($managerId: uuid) {
  leaves(
    where: {
      _and: [
        { status: { _eq: "Pending" } }
        { user: { managerId: { _eq: $managerId } } }
      ]
    }
    order_by: { startDate: asc }
  ) {
    ...LeaveWithUser
  }
}

query GetLeaveOverlaps(
  $startDate: date!
  $endDate: date!
  $excludeId: uuid
) {
  leaves(
    where: {
      _and: [
        { startDate: { _lte: $endDate } }
        { endDate: { _gte: $startDate } }
        { status: { _neq: "Rejected" } }
        { id: { _neq: $excludeId } }
      ]
    }
  ) {
    ...LeaveWithUser
  }
}

query GetLeaveCalendar(
  $startDate: date!
  $endDate: date!
  $userIds: [uuid!]
) {
  leaves(
    where: {
      _and: [
        { startDate: { _lte: $endDate } }
        { endDate: { _gte: $startDate } }
        { status: { _eq: "Approved" } }
        { userId: { _in: $userIds } }
      ]
    }
    order_by: { startDate: asc }
  ) {
    ...LeaveWithUser
  }
}

query GetLeaveAnalytics($startDate: date!, $endDate: date!) {
  leave_by_type: leavesAggregate(
    where: { startDate: { _gte: $startDate, _lte: $endDate } }
  ) {
    nodes {
      leaveType
    }
    aggregate {
      count
    }
  }

  leave_by_status: leavesAggregate(
    where: { startDate: { _gte: $startDate, _lte: $endDate } }
  ) {
    nodes {
      status
    }
    aggregate {
      count
    }
  }

  leave_by_user: leaves(where: {}) {
    user {
      id
      name
    }
  }
}
