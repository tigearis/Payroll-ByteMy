# Leave Domain Mutations
# Security Classification: MEDIUM - Employee leave and HR data
# SOC2 Compliance: All mutations logged with audit trail

# Core CRUD operations
mutation CreateLeave($object: LeaveInsertInput!) {
  insertLeaveOne(object: $object) {
    ...LeaveDetailed
    employee {
      id
      firstName
      lastName
      computedName
      email
      manager {
        id
        firstName
        lastName
        computedName
        email
      }
    }
  }
}

mutation UpdateLeave($id: uuid!, $set: LeaveSetInput!) {
  updateLeaveByPk(pkColumns: { id: $id }, _set: $set) {
    ...LeaveDetailed
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation DeleteLeave($id: uuid!) {
  deleteLeaveByPk(id: $id) {
    id
    leaveType
    startDate
    endDate
  }
}

# Quick create mutations for common leave types
mutation CreateAnnualLeave(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $reason: String
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: "Annual"
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation CreateSickLeave(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $reason: String
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: "Sick"
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation CreateUnpaidLeave(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $reason: String
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: "Unpaid"
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation CreateOtherLeave(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $reason: String!
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: "Other"
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

# Status management mutations
mutation ApproveLeave($id: uuid!) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { status: Approved }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation RejectLeave($id: uuid!) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { status: Rejected }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation SetLeavePending($id: uuid!) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { status: Pending }
  ) {
    ...LeaveBasic
  }
}

# Bulk operations
mutation BulkApproveLeave($leaveIds: [uuid!]!) {
  updateLeave(
    where: { id: { _in: $leaveIds } }
    _set: { status: Approved }
  ) {
    returning {
      ...LeaveBasic
    }
    affectedRows
  }
}

mutation BulkRejectLeave($leaveIds: [uuid!]!) {
  updateLeave(
    where: { id: { _in: $leaveIds } }
    _set: { status: Rejected }
  ) {
    returning {
      ...LeaveBasic
    }
    affectedRows
  }
}

mutation BulkDeleteLeave($leaveIds: [uuid!]!) {
  deleteLeave(where: { id: { _in: $leaveIds } }) {
    affectedRows
    returning {
      id
      leaveType
      startDate
      endDate
    }
  }
}

# Update operations
mutation UpdateLeaveDetails(
  $id: uuid!
  $startDate: date
  $endDate: date
  $leaveType: String
  $reason: String
) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: {
      startDate: $startDate
      endDate: $endDate
      leaveType: $leaveType
      reason: $reason
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation UpdateLeaveDates(
  $id: uuid!
  $startDate: date!
  $endDate: date!
) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: {
      startDate: $startDate
      endDate: $endDate
    }
  ) {
    ...LeaveBasic
  }
}

mutation UpdateLeaveType($id: uuid!, $leaveType: String!) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { leaveType: $leaveType }
  ) {
    ...LeaveBasic
  }
}

mutation UpdateLeaveReason($id: uuid!, $reason: String) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { reason: $reason }
  ) {
    ...LeaveBasic
  }
}

# Administrative operations
mutation CancelLeave($id: uuid!) {
  deleteLeaveByPk(id: $id) {
    id
    leaveType
    startDate
    endDate
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation TransferLeave($id: uuid!, $newUserId: uuid!) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: { userId: $newUserId }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

# User-specific operations
mutation CreateMyLeave(
  $startDate: date!
  $endDate: date!
  $leaveType: String!
  $reason: String
) {
  insertLeaveOne(
    object: {
      startDate: $startDate
      endDate: $endDate
      leaveType: $leaveType
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveBasic
    employee {
      id
      firstName
      lastName
      computedName
      email
    }
  }
}

mutation UpdateMyLeave(
  $id: uuid!
  $startDate: date
  $endDate: date
  $leaveType: String
  $reason: String
) {
  updateLeaveByPk(
    pkColumns: { id: $id }
    _set: {
      startDate: $startDate
      endDate: $endDate
      leaveType: $leaveType
      reason: $reason
    }
  ) {
    ...LeaveBasic
  }
}

mutation CancelMyLeave($id: uuid!) {
  deleteLeaveByPk(id: $id) {
    id
    leaveType
    startDate
    endDate
  }
}

# Manager leave creation mutations
mutation CreateLeaveForEmployee(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $leaveType: String!
  $reason: String
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: $leaveType
      reason: $reason
      status: Approved
    }
  ) {
    ...LeaveDetailed
    employee {
      id
      firstName
      lastName
      computedName
      email
      role
      manager {
        id
        firstName
        lastName
        computedName
        email
        role
      }
    }
  }
}

mutation CreatePendingLeaveForEmployee(
  $employeeId: uuid!
  $startDate: date!
  $endDate: date!
  $leaveType: String!
  $reason: String
) {
  insertLeaveOne(
    object: {
      userId: $employeeId
      startDate: $startDate
      endDate: $endDate
      leaveType: $leaveType
      reason: $reason
      status: Pending
    }
  ) {
    ...LeaveDetailed
    employee {
      id
      firstName
      lastName
      computedName
      email
      role
      manager {
        id
        firstName
        lastName
        computedName
        email
        role
      }
    }
  }
}