# Audit Domain Subscriptions

# Subscribe to new audit logs
subscription SubscribeToAuditLogs {
  auditLogs(order_by: { eventTime: desc }, limit: 1) {
    ...AuditLogWithUser
  }
}

# Subscribe to failed operations
subscription SubscribeToFailedOperations {
  auditLogs(
    where: { success: { _eq: false } }
    order_by: { eventTime: desc }
    limit: 10
  ) {
    ...AuditLogCore
  }
}

# Subscribe to user audit activity
subscription SubscribeToUserAuditActivity($user_id: uuid!) {
  auditLogs(
    where: { userId: { _eq: $user_id } }
    order_by: { eventTime: desc }
    limit: 20
  ) {
    ...AuditLogCore
  }
}

# Subscribe to data access logs
subscription SubscribeToDataAccessLogs {
  dataAccessLogs(order_by: { accessedAt: desc }, limit: 10) {
    ...DataAccessLogCore
  }
}

# Real-time security events for dashboard
subscription SecurityEventsStream($twentyFourHoursAgo: timestamptz!) {
  auditLogs(
    where: { eventTime: { _gte: $twentyFourHoursAgo } }
    order_by: { eventTime: desc }
    limit: 50
  ) {
    id
    eventTime
    userId
    userEmail
    userRole
    action
    resourceType
    resourceId
    success
    error_message
    ipAddress
    metadata
  }
}

# Real-time failed operations stream
subscription FailedOperationsStream($twentyFourHoursAgo: timestamptz!) {
  auditLogs(
    where: { 
      success: { _eq: false }
      eventTime: { _gte: $twentyFourHoursAgo } 
    }
    order_by: { eventTime: desc }
    limit: 20
  ) {
    id
    eventTime
    userId
    userEmail
    userRole
    action
    resourceType
    error_message
    ipAddress
  }
}

# Real-time critical data access stream
subscription CriticalDataAccessStream($sevenDaysAgo: timestamptz!) {
  dataAccessLogs(
    where: { 
      accessedAt: { _gte: $sevenDaysAgo }
      dataClassification: { _eq: "CRITICAL" }
    }
    order_by: { accessedAt: desc }
    limit: 30
  ) {
    id
    accessedAt
    userId
    resourceType
    accessType
    dataClassification
    rowCount
    ipAddress
  }
}
