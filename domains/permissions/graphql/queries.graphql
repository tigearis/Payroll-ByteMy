# Permissions Domain Queries

# Resources
query GetResources {
  resources(orderBy: { name: ASC }) {
    ...ResourceCore
  }
}

query GetResourceById($id: uuid!) {
  resourceById(id: $id) {
    ...ResourceCore
  }
}

# Permissions
query GetPermissions {
  permissions(orderBy: { action: ASC }) {
    ...PermissionWithResource
  }
}

query GetPermissionById($id: uuid!) {
  permissionById(id: $id) {
    ...PermissionWithResource
  }
}

# Roles
query GetRoles($where: rolesBoolExp, $orderBy: [rolesOrderBy!]) {
  roles(where: $where, orderBy: $orderBy) {
    ...RoleCore
  }
}

query GetRoleById($id: uuid!) {
  roleById(id: $id) {
    ...RoleCore
    assignedPermissions {
      ...RolePermissionWithDetails
    }
  }
}

query GetRolePermissions($roleId: uuid!) {
  rolePermissions(where: { roleId: { _eq: $roleId } }) {
    ...RolePermissionWithDetails
  }
}

query GetSystemRoles {
  roles(where: { isSystemRole: { _eq: true } }, orderBy: { priority: ASC }) {
    ...RoleCore
  }
}

# User Roles
query GetUserRoles($userId: uuid!) {
  userRoles(where: { userId: { _eq: $userId } }) {
    ...UserRoleWithDetails
  }
}

query GetUsersWithRole($roleId: uuid!) {
  userRoles(where: { roleId: { _eq: $roleId } }) {
    ...UserRoleWithDetails
  }
}

# Feature Flags
query GetFeatureFlags($where: featureFlagsBoolExp) {
  featureFlags(where: $where) {
    ...FeatureFlagCore
  }
}

query GetFeatureFlagById($id: uuid!) {
  featureFlagById(id: $id) {
    ...FeatureFlagCore
  }
}

# App Settings
query GetAppSettings {
  appSettings {
    ...AppSettingsCore
  }
}

# Analytics
query GetPermissionAnalytics {
  roles_count: rolesAggregate {
    aggregate {
      count
    }
  }

  permissions_count: permissionsAggregate {
    aggregate {
      count
    }
  }

  resources_count: resourcesAggregate {
    aggregate {
      count
    }
  }

  userRoles_count: userRolesAggregate {
    aggregate {
      count
    }
  }

  roles_by_priority: roles(orderBy: { priority: ASC }) {
    name
    displayName
    priority
    assignedToUsersAggregate {
      aggregate {
        count
      }
    }
  }
}
