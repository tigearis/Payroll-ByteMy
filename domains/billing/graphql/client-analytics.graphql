# Client Analytics Summary

query GetClientAnalytics(
  $limit: Int = 50
  $orderBy: [ClientAnalyticsSummaryOrderBy!] = [{ totalRevenue: DESC }]
  $activeOnly: Boolean = true
) {
  clientAnalytics: clientAnalyticsSummary(
    where: { isActive: { _eq: $activeOnly }, totalBillingItems: { _gt: 0 } }
    limit: $limit
    orderBy: $orderBy
  ) {
    clientId
    clientName
    contactPerson
    contactEmail
    isActive
    totalBillingItems
    totalRevenue
    averageItemValue
    approvedItems
    pendingItems
    draftItems
    approvedRevenue
    pendingRevenue
    draftRevenue
    payrollCount
    activePayrolls
    approvalRatePercent
    activityStatus
    firstBillingItem
    lastBillingItem
  }

  clientSummary: clientAnalyticsSummaryAggregate(
    where: { isActive: { _eq: $activeOnly }, totalBillingItems: { _gt: 0 } }
  ) {
    aggregate {
      count
      sum {
        totalRevenue
        totalBillingItems
        payrollCount
      }
      avg {
        averageItemValue
        approvalRatePercent
      }
    }
  }
}

