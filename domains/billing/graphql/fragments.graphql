# Billing Domain Fragments - Enhanced Billing System with Quotes
# Security Classification: HIGH - Financial and billing data
# SOC2 Compliance: Financial data with strict audit requirements

# Service Catalog Fragment (updated to use Services table)
fragment ServiceCatalogFragment on Services {
  id
  name
  description
  defaultRate
  billingUnit
  category
  isActive
  currency
  serviceType
  metadata
  createdAt
  updatedAt
}

# Client Service Agreement Fragment (updated)
fragment ClientServiceAgreementFragment on ClientServiceAgreements {
  id
  clientId
  serviceId
  customRate
  billingFrequency
  contractStartDate
  isEnabled
  isActive
  createdAt
  updatedAt
  service {
    ...ServiceCatalogFragment
  }
  client {
    id
    name
  }
}

# Quote Fragment
fragment QuoteFragment on Quotes {
  id
  quoteNumber
  clientId
  prospectName
  prospectEmail
  prospectPhone
  prospectCompany
  status
  totalAmount
  validUntil
  createdBy
  convertedAt
  convertedToClientId
  conversionValue
  notes
  termsConditions
  createdAt
  updatedAt
  client {
    id
    name
  }
  createdByUser {
    id
    firstName
    lastName
  }
}

# Quote Line Item Fragment
fragment QuoteLineItemFragment on QuoteLineItems {
  id
  quoteId
  serviceId
  description
  quantity
  unitRate
  totalAmount
  notes
  createdAt
  service {
    ...ServiceCatalogFragment
  }
}

# Quote Template Fragment
fragment QuoteTemplateFragment on QuoteTemplates {
  id
  name
  description
  category
  serviceBundle
  targetClientSize
  targetIndustry
  estimatedTotal
  isActive
  isPublic
  createdBy
  createdAt
  updatedAt
  createdByUser {
    id
    firstName
    lastName
  }
}

# Quote Conversion Fragment
fragment QuoteConversionFragment on QuoteConversions {
  id
  quoteId
  clientId
  conversionDate
  serviceAgreementsCreated
  totalValue
  conversionNotes
  createdBy
  quote {
    ...QuoteFragment
  }
  client {
    id
    name
  }
  createdByUser {
    id
    firstName
    lastName
  }
}

# Enhanced Billing Item Fragment
fragment BillingItemFragment on BillingItems {
  id
  clientId
  payrollId
  payrollDateId
  serviceId
  quoteId
  quantity
  unitPrice
  amount
  description
  status
  isAutoGenerated
  staffUserId
  notes
  confirmedAt
  confirmedBy
  createdAt
  updatedAt
  client {
    id
    name
  }
  service {
    ...ServiceCatalogFragment
  }
  quote {
    id
    quoteNumber
  }
  payroll {
    id
    name
  }
}

# Enhanced Time Entry Fragment with 6-minute tracking
fragment TimeEntryFragment on TimeEntries {
  id
  staffUserId
  clientId
  payrollId
  payrollDateId
  workDate
  hoursSpent
  timeUnits
  billingRate
  isBillable
  billingNotes
  description
  createdAt
  updatedAt
  client {
    id
    name
  }
  payroll {
    id
    name
  }
}

# Billing Period Fragment
fragment BillingPeriodFragment on BillingPeriods {
  id
  clientId
  periodStart
  periodEnd
  status
  createdAt
  updatedAt
  client {
    id
    name
  }
}

# Enhanced Invoice Fragment
fragment BillingInvoiceFragment on BillingInvoice {
  id
  clientId
  billingPeriodStart
  billingPeriodEnd
  billingPeriodId
  issuedDate
  dueDate
  status
  totalAmount
  invoiceNumber
  createdAt
  updatedAt
  client {
    id
    name
    contactPerson
    contactEmail
  }
}

# Invoice Item Fragment
fragment BillingInvoiceItemFragment on BillingInvoiceItem {
  id
  invoiceId
  descriptionOverride
  quantityHours
  hourlyRate
  netAmount
  totalAmount
  createdAt
}

# Enhanced Payroll Billing Fragment
fragment PayrollBillingFragment on Payrolls {
  id
  name
  clientId
  employeeCount
  payslipCount
  newEmployees
  terminatedEmployees
  billingStatus
  estimatedRevenue
  actualRevenue
  estimatedHours
  actualHours
  profitMargin
  lastBilledDate
  createdAt
  updatedAt
  client {
    id
    name
  }
  billingItems {
    ...BillingItemFragment
  }
  timeEntries {
    ...TimeEntryFragment
  }
}

# User Fragment for relationships
fragment UserFragment on Users {
  id
  firstName
  lastName
  email
}

# Client Fragment for relationships
fragment ClientFragment on Clients {
  id
  name
  contactPerson
  contactEmail
  createdAt
  updatedAt
}