# Payroll Domain Specific Fragments

# Payroll processing info
fragment PayrollProcessingInfo on Payrolls {
  id
  name
  status
  employeeCount
  processingTime
  processingDaysBeforeEft
  goLiveDate
}

# Payroll version info - fixing createdBy field
fragment PayrollVersionInfo on Payrolls {
  id
  versionNumber
  versionReason
  parentPayrollId
  supersededDate
  createdAt
  createdByUserId
}

# Payroll with all relations - fixing createdBy field
fragment PayrollWithAllRelations on Payrolls {
  ...PayrollBase
  client {
    ...ClientMinimal
  }
  primaryConsultant {
    ...UserMinimal
  }
  backupConsultant {
    ...UserMinimal
  }
  assignedManager {
    ...UserMinimal
  }
  cycleId
  dateTypeId
  dateValue
  payrollCycle {
    id
    name
    description
  }
  payrollDateType {
    id
    name
    description
  }
  createdByUserId
}

# Payroll for assignment
fragment PayrollForAssignment on Payrolls {
  id
  name
  status
  clientId
  employeeCount
  processingTime
  processingDaysBeforeEft
  client {
    ...ClientMinimal
  }
  primaryConsultantUserId
  backupConsultantUserId
  managerUserId
  requiredSkills {
    skillName
    requiredLevel
  }
  payrollDates(
    where: { adjustedEftDate: { _gte: "today()" } }
    orderBy: { adjustedEftDate: ASC }
    limit: 3
  ) {
    id
    originalEftDate
    adjustedEftDate
    processingDate
  }
}

# Payroll basic info
fragment PayrollBasic on Payrolls {
  id
  name
  status
  employeeCount
  client {
    ...ClientMinimal
  }
}

# Payroll for audit - fixing createdBy field
fragment PayrollForAudit on Payrolls {
  id
  name
  status
  versionNumber
  createdAt
  updatedAt
  createdByUserId
}

# Payroll table row
fragment PayrollTableRow on Payrolls {
  ...PayrollListItem
  goLiveDate
  processingTime
  versionNumber

  # Payroll cycle for schedule column
  cycleId
  payrollCycle {
    id
    name
    description
  }

  # Next EFT date - use adjusted if present, otherwise original; match detail page behavior
  nextPayrollDate: payrollDates(
    where: {
      _or: [
        { adjustedEftDate: { _gte: "now()" } }
        { originalEftDate: { _gte: "now()" } }
      ]
    }
    orderBy: [{ adjustedEftDate: ASC }, { originalEftDate: ASC }]
    limit: 1
  ) {
    originalEftDate
    adjustedEftDate
    processingDate
  }
}

# Payroll dashboard card
fragment PayrollDashboardCard on Payrolls {
  ...PayrollMinimal
  client {
    ...ClientMinimal
  }
  primaryConsultant {
    ...UserMinimal
  }
  goLiveDate
}

# Payroll date fragment - fixing field names to match schema
fragment PayrollDate on PayrollDates {
  id
  payrollId
  originalEftDate
  adjustedEftDate
  processingDate
  notes
  status
  completedAt
  completedBy
  createdAt
  payroll {
    id
    name
  }
}

# Payroll detailed
fragment PayrollDetailed on Payrolls {
  ...PayrollFullDetail
  requiredSkills {
    skillName
    requiredLevel
  }
}

# Payroll summary
fragment PayrollSummary on Payrolls {
  ...PayrollBase
  client {
    ...ClientMinimal
  }
  primaryConsultant {
    ...UserMinimal
  }
}

# Missing fragments that were referenced in queries
fragment PayrollWithCycle on Payrolls {
  ...PayrollBase
  cycleId
  payrollCycle {
    id
    name
  }
}

fragment PayrollWorkload on Payrolls {
  id
  name
  status
  employeeCount
  processingTime
  processingDaysBeforeEft
  primaryConsultantUserId
  backupConsultantUserId
  managerUserId
  client {
    ...ClientMinimal
  }
}
