# Payroll Queries

query GetPayrolls {
  payrolls(
    where: { superseded_date: { _is_null: true } }
    order_by: { updated_at: desc }
  ) {
    ...PayrollWithDates
  }
}

query GetPayrollsFallback {
  payrolls {
    id
    name
    status
  }
}

query GetPayrollById($id: uuid!) {
  payrolls_by_pk(id: $id) {
    ...PayrollWithDates
  }
}

query GetPayrollsByClient($clientId: uuid!) {
  payrolls(
    where: {
      client_id: { _eq: $clientId }
      superseded_date: { _is_null: true }
    }
    order_by: { updated_at: desc }
  ) {
    ...PayrollWithDates
  }
}

query GetPayrollsByMonth($startDate: date!, $endDate: date!) {
  payrolls(
    where: {
      superseded_date: { _is_null: true }
      payroll_dates: { adjusted_eft_date: { _gte: $startDate, _lte: $endDate } }
    }
    order_by: { updated_at: desc }
  ) {
    ...PayrollWithDates
  }
}

query GetPayrollDates($payrollId: uuid!) {
  payroll_dates(
    where: { payroll_id: { _eq: $payrollId } }
    order_by: { adjusted_eft_date: asc }
  ) {
    ...PayrollDate
  }
}

query GetPayrollFamilyDates($payrollId: uuid!) {
  payrolls(
    where: {
      _or: [
        { id: { _eq: $payrollId } }
        { parent_payroll_id: { _eq: $payrollId } }
      ]
    }
    order_by: { version_number: asc }
  ) {
    id
    version_number
    payroll_dates(order_by: { adjusted_eft_date: asc }) {
      ...PayrollDate
    }
  }
}

query GetPayrollsMissingDates {
  payrolls(
    where: { superseded_date: { _is_null: true }, _not: { payroll_dates: {} } }
  ) {
    id
    name
    client {
      name
    }
  }
}

query GetPayrollsSimple {
  payrolls {
    id
    name
    status
    updated_at
    client {
      id
      name
    }
  }
}

query CheckPayrollVersion($id: uuid!) {
  payrolls_by_pk(id: $id) {
    id
    superseded_date
    version_number
  }
  latest: payrolls(
    where: {
      parent_payroll_id: { _eq: $id }
      superseded_date: { _is_null: true }
    }
    limit: 1
  ) {
    id
  }
}

# Extracted from inline GraphQL operations
query GetPayrollDatesById($id: uuid!) {
  payroll_dates(
    where: { payroll_id: { _eq: $id } },
    order_by: { adjusted_eft_date: asc }
  ) {
    id
    original_eft_date
    adjusted_eft_date
    processing_date
    notes
  }
}

query GetPayrollVersionHistory($payrollId: uuid!) {
  payrolls(
    where: {
      _or: [
        { id: { _eq: $payrollId } },
        { parent_payroll_id: { _eq: $payrollId } }
      ]
    }
    order_by: { version_number: desc }
  ) {
    id
    name
    version_number
    status
    created_at
    superseded_date
    go_live_date
    notes
  }
}

query GetLatestPayrollVersion($payrollId: uuid!) {
  payrolls(
    where: {
      _or: [
        { id: { _eq: $payrollId } },
        { parent_payroll_id: { _eq: $payrollId } }
      ],
      superseded_date: { _is_null: true }
    }
    limit: 1
  ) {
    id
    name
    version_number
    status
    parent_payroll_id
  }
}

query GeneratePayrollDatesTwoYears($startDate: date!, $endDate: date!) {
  generate_payroll_dates_two_years(
    args: { 
      start_date: $startDate,
      end_date: $endDate 
    }
  ) {
    original_eft_date
    adjusted_eft_date
    processing_date
  }
}
