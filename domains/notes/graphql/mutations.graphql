# Notes Domain Mutations
# Security Classification: MEDIUM - Internal data with role-based access
# SOC2 Compliance: User-based access control with audit logging

mutation AddNote(
  $entity_id: uuid!
  $entity_type: String!
  $content: String!
  $user_id: uuid!
  $isImportant: Boolean = false
) {
  insert_notes_one(object: { content: $content, is_important: $isImportant }) {
    ...NoteWithUser
  }
}

mutation UpdateNote($id: uuid!, $content: String!, $isImportant: Boolean) {
  update_notes_by_pk(
    pk_columns: { id: $id }
    _set: { content: $content, is_important: $isImportant, updated_at: "now()" }
  ) {
    ...NoteWithUser
  }
}

mutation UpdateNoteContent($id: uuid!, $content: String!) {
  update_notes_by_pk(
    pk_columns: { id: $id }
    _set: { content: $content, updated_at: "now()" }
  ) {
    ...NoteBasicInfo
  }
}

mutation DeleteNote($id: uuid!) {
  delete_notes_by_pk(id: $id) {
    id
    # Return minimal info for audit trail
  }
}

mutation MarkNoteImportant($id: uuid!, $isImportant: Boolean!) {
  update_notes_by_pk(
    pk_columns: { id: $id }
    _set: { is_important: $isImportant, updated_at: "now()" }
  ) {
    ...NoteBasicInfo
  }
}

# Bulk operations for efficiency
mutation BulkDeleteNotes($entity_id: uuid!, $entity_type: String!) {
  delete_notes(
    where: {
      entity_id: { _eq: $entity_id }
      entity_type: { _eq: $entity_type }
    }
  ) {
    affected_rows
    returning {
      id
    }
  }
}

mutation UpdateNoteWithSetInput($id: uuid!, $input: notes_set_input!) {
  update_notes_by_pk(pk_columns: { id: $id }, _set: $input) {
    id
    content
  }
}

# Extracted from inline GraphQL operations
mutation AddNoteExtracted(
  $entity_type: String!
  $entity_id: uuid!
  $content: String!
) {
  insert_notes_one(object: { content: $content, is_important: false }) {
    id
    content
    is_important
  }
}

mutation UpdateNoteExtracted($id: uuid!, $content: String!) {
  update_notes_by_pk(
    pk_columns: { id: $id }
    _set: { content: $content, updated_at: "now()" }
  ) {
    id
    content
  }
}
