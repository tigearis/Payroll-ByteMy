# External Systems Domain Mutations
# Security Classification: MEDIUM - Integration and configuration data
# SOC2 Compliance: All mutations logged with comprehensive audit trail

# External system CRUD operations
mutation CreateExternalSystem($object: ExternalSystemsInsertInput!) {
  insertExternalSystemsOne(object: $object) {
    ...ExternalSystemDetailed
  }
}

mutation UpdateExternalSystem($id: uuid!, $set: ExternalSystemsSetInput!) {
  updateExternalSystemsByPk(pkColumns: { id: $id }, _set: $set) {
    ...ExternalSystemDetailed
  }
}

mutation DeleteExternalSystem($id: uuid!) {
  deleteExternalSystemsByPk(id: $id) {
    id
    name
  }
}

# Client external system operations
mutation CreateClientExternalSystem($object: ClientExternalSystemsInsertInput!) {
  insertClientExternalSystemsOne(object: $object) {
    ...ClientExternalSystemComplete
  }
}

mutation UpdateClientExternalSystem($id: uuid!, $set: ClientExternalSystemsSetInput!) {
  updateClientExternalSystemsByPk(pkColumns: { id: $id }, _set: $set) {
    ...ClientExternalSystemComplete
  }
}

mutation DeleteClientExternalSystem($id: uuid!) {
  deleteClientExternalSystemsByPk(id: $id) {
    id
    clientId
  }
}

mutation ConnectClientToSystem(
  $clientId: uuid!
  $externalSystemId: uuid!
  $systemClientId: String
) {
  insertClientExternalSystemsOne(
    object: {
      clientId: $clientId
      systemClientId: $systemClientId
    }
  ) {
    ...ClientExternalSystemComplete
  }
}

mutation DisconnectClientFromSystem($id: uuid!) {
  deleteClientExternalSystemsByPk(id: $id) {
    id
    clientId
  }
}

# Bulk operations
mutation BulkDeleteExternalSystems($systemIds: [uuid!]!) {
  deleteExternalSystems(where: { id: { _in: $systemIds } }) {
    affectedRows
    returning {
      id
      name
    }
  }
}

mutation BulkDeleteClientExternalSystems($clientSystemIds: [uuid!]!) {
  deleteClientExternalSystems(where: { id: { _in: $clientSystemIds } }) {
    affectedRows
    returning {
      id
      clientId
      }
  }
}

# Administrative operations
mutation DisconnectAllClientSystemsBySystem($externalSystemId: uuid!) {
  deleteClientExternalSystems(where: { externalSystem: { id: { _eq: $externalSystemId } } }) {
    affectedRows
    returning {
      id
      clientId
      }
  }
}

mutation DisconnectAllClientSystemsByClient($clientId: uuid!) {
  deleteClientExternalSystems(where: { clientId: { _eq: $clientId } }) {
    affectedRows
    returning {
      id
      clientId
      }
  }
}

mutation TransferClientSystemConnections($oldClientId: uuid!, $newClientId: uuid!) {
  updateClientExternalSystems(
    where: { clientId: { _eq: $oldClientId } }
    _set: { clientId: $newClientId, updatedAt: "now()" }
  ) {
    affectedRows
    returning {
      id
      clientId
      }
  }
}

# Maintenance operations
mutation UpdateExternalSystemDetails(
  $id: uuid!
  $name: String
  $description: String
  $url: String
  $icon: String
) {
  updateExternalSystemsByPk(
    pkColumns: { id: $id }
    _set: {
      name: $name
      description: $description
      url: $url
      icon: $icon
      updatedAt: "now()"
    }
  ) {
    ...ExternalSystemBasic
  }
}

mutation UpdateClientSystemMapping(
  $id: uuid!
  $systemClientId: String
) {
  updateClientExternalSystemsByPk(
    pkColumns: { id: $id }
    _set: {
      systemClientId: $systemClientId
      updatedAt: "now()"
    }
  ) {
    ...ClientExternalSystemBasic
  }
}