# Clients Domain Queries
# Security Classification: HIGH - Contains PII and business-critical data
# SOC2 Compliance: Row-level security and audit logging enforced

query GetClients {
  clients(where: { active: { _eq: true } }, order_by: { name: asc }) {
    ...ClientBasicInfo
  }
}

query GetClientsWithContact {
  clients(where: { active: { _eq: true } }, order_by: { name: asc }) {
    ...ClientWithContact
  }
}

query GetClientById($id: uuid!) {
  client(id: $id) {
    ...ClientWithRelations
  }
}

query GetClientBasicById($id: uuid!) {
  client(id: $id) {
    ...ClientBasicInfo
  }
}

query GetActiveClients {
  clients(where: { active: { _eq: true } }, order_by: { name: asc }) {
    ...ClientBasicInfo
  }
}

query GetClientsForBilling {
  clients(where: { active: { _eq: true } }, order_by: { name: asc }) {
    ...ClientForBilling
  }
}

query SearchClients($searchTerm: String!) {
  clients(
    where: {
      _and: [
        { active: { _eq: true } }
        {
          _or: [
            { name: { _ilike: $searchTerm } }
            { contactPerson: { _ilike: $searchTerm } }
            { contactEmail: { _ilike: $searchTerm } }
          ]
        }
      ]
    }
    order_by: { name: asc }
    limit: 50
  ) {
    ...ClientWithContact
  }
}

# Audit query - limited fields for compliance
query GetClientsForAudit {
  clients(order_by: { createdAt: desc }) {
    ...ClientForAudit
  }
}

query GetClientStats {
  clientsAggregate {
    aggregate {
      count
    }
  }
  active_clients: clientsAggregate(where: { active: { _eq: true } }) {
    aggregate {
      count
    }
  }
  inactive_clients: clientsAggregate(where: { active: { _eq: false } }) {
    aggregate {
      count
    }
  }
}
