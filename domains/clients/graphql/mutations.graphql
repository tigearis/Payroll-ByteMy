# Clients Domain Mutations
# Security Classification: HIGH - PII and business-critical operations
# SOC2 Compliance: Full audit trail with user attribution

mutation CreateClient(
  $name: String!
  $contactName: String
  $contactEmail: String
  $contactPhone: String
  $address: String
  $city: String
  $state: String
  $postalCode: String
  $country: String = "Australia"
) {
  insertClient(
    object: {
      name: $name
      contactEmail: $contactEmail
      contactPhone: $contactPhone
    }
  ) {
    ...ClientWithContact
  }
}

mutation UpdateClient(
  $id: uuid!
  $name: String
  $contactName: String
  $contactEmail: String
  $contactPhone: String
  $address: String
  $city: String
  $state: String
  $postalCode: String
  $country: String
) {
  updateClientById(
    pkColumns: { id: $id }
    _set: {
      name: $name
      contactEmail: $contactEmail
      contactPhone: $contactPhone
    }
  ) {
    ...ClientWithContact
  }
}

mutation UpdateClientStatus($id: uuid!, $active: Boolean!) {
  updateClientById(
    pkColumns: { id: $id }
    _set: { active: $active, updatedAt: "now()" }
  ) {
    ...ClientBasicInfo
  }
}

mutation DeactivateClient($id: uuid!) {
  updateClientById(
    pkColumns: { id: $id }
    _set: { active: false, updatedAt: "now()" }
  ) {
    ...ClientBasicInfo
  }
}

mutation ActivateClient($id: uuid!) {
  updateClientById(
    pkColumns: { id: $id }
    _set: { active: true, updatedAt: "now()" }
  ) {
    ...ClientBasicInfo
  }
}

# Soft delete - preserves audit trail
mutation ArchiveClient($id: uuid!) {
  updateClientById(
    pkColumns: { id: $id }
    _set: { active: false, updatedAt: "now()" }
  ) {
    id
    name
  }
}

# Bulk operations for efficiency
mutation BulkUpdateClientStatus($clientIds: [uuid!]!, $active: Boolean!) {
  bulkUpdateClients(
    where: { id: { _in: $clientIds } }
    _set: { active: $active, updatedAt: "now()" }
  ) {
    affectedRows
    returning {
      ...ClientBasicInfo
    }
  }
}

mutation DeleteClient($id: uuid!) {
  updateClientById(pkColumns: { id: $id }, _set: { active: false }) {
    id
    name
    active
  }
}
