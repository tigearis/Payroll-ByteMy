# Clients Domain Fragments
# Security Classification: HIGH - Contains PII and business-critical data
# SOC2 Compliance: Customer data with audit trail requirements

fragment ClientBasicInfo on clients {
  id
  name
}

fragment ClientWithContact on clients {
  ...ClientBasicInfo
  contactEmail
  contactPhone
}

fragment ClientForBilling on clients {
  id
  name
  contactPerson
  contactEmail
}

fragment ClientForAudit on clients {
  id
  name
  # Contact info excluded from audit logs for privacy
}

fragment ClientWithRelations on clients {
  ...ClientWithContact
  active
  contactPerson
  createdAt
  updatedAt
  payrolls(where: { supersededDate: { _isNull: true } }) {
    id
    name
    status
    employeeCount
    createdAt
    updatedAt
    primaryConsultant {
      id
      name
    }
    manager {
      id
      name
    }
    payrollCycle {
      id
      name
    }
    supersededDate
  }
}

# Performance-optimized fragments for Phase 2

fragment ClientSummary on clients {
  id
  name
  active
}

fragment ClientListItem on clients {
  ...ClientSummary
  contactEmail
  contactPhone
  payrollCount: payrollsAggregate {
    aggregate {
      count
    }
  }
}

fragment ClientDashboardCard on clients {
  ...ClientSummary
  activePayrolls: payrollsAggregate(
    where: { supersededDate: { _isNull: true } }
  ) {
    aggregate {
      count
    }
  }
}

fragment ClientTableRow on clients {
  ...ClientListItem
  contactPerson
  updatedAt
}

fragment ClientMinimal on clients {
  id
  name
}

fragment ClientWithMetrics on clients {
  ...ClientSummary
  totalPayrolls: payrollsAggregate {
    aggregate {
      count
    }
  }
  activePayrolls: payrollsAggregate(
    where: { supersededDate: { _isNull: true } }
  ) {
    aggregate {
      count
    }
  }
  recentPayrolls: payrolls(
    orderBy: { updatedAt: DESC }
    limit: 3
  ) {
    id
    name
    status
    updatedAt
  }
}
