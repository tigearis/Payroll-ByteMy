# Clients Domain Fragments
# Security Classification: HIGH - Contains PII and business-critical data
# SOC2 Compliance: Customer data with audit trail requirements

fragment ClientBasicInfo on clients {
  id
  name
}

fragment ClientWithContact on clients {
  ...ClientBasicInfo
  contactEmail
  contactPhone
}

fragment ClientForBilling on clients {
  id
  name
  billing_contactPerson: contactPerson
  billing_contact_email: contactEmail
}

fragment ClientForAudit on clients {
  id
  name
  # Contact info excluded from audit logs for privacy
}

fragment ClientWithRelations on clients {
  ...ClientWithContact
  active
  payrolls {
    id
    name
  }
  notes: externalSystems {
    id
    system_id
  }
}

# Performance-optimized fragments for Phase 2

fragment ClientSummary on clients {
  id
  name
  active
}

fragment ClientListItem on clients {
  ...ClientSummary
  contactEmail
  contactPhone
  payrollCount: payrolls_aggregate {
    aggregate {
      count
    }
  }
}

fragment ClientDashboardCard on clients {
  ...ClientSummary
  activePayrolls: payrolls_aggregate(
    where: { supersededDate: { _is_null: true } }
  ) {
    aggregate {
      count
    }
  }
}

fragment ClientTableRow on clients {
  ...ClientListItem
  contactPerson
  updatedAt
}

fragment ClientMinimal on clients {
  id
  name
}

fragment ClientWithMetrics on clients {
  ...ClientSummary
  totalPayrolls: payrolls_aggregate {
    aggregate {
      count
    }
  }
  activePayrolls: payrolls_aggregate(
    where: { supersededDate: { _is_null: true } }
  ) {
    aggregate {
      count
    }
  }
  recentPayrolls: payrolls(
    order_by: { updatedAt: desc }
    limit: 3
  ) {
    id
    name
    status
    updatedAt
  }
}
