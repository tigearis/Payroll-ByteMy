# Users Domain Subscriptions
# Security Classification: CRITICAL - Employee PII and authentication data
# SOC2 Compliance: Strict access controls with audit logging

# Extracted from inline GraphQL operations
subscription StaffSubscription {
  users(where: { isStaff: { _eq: true } }) {
    id
    name
    role
    updatedAt
  }
}

subscription UserUpdates($id: uuid!) {
  users(where: { id: { _eq: $id } }) {
    ...UserBasicInfo
  }
}

subscription StaffListUpdates {
  users(
    where: { role: { _in: ["consultant", "manager", "org_admin"] } }
    orderBy: { name: ASC }
  ) {
    ...UserBasicInfo
  }
}

# Real-time authentication and user status subscriptions

subscription UserRoleChanges($userId: uuid!) {
  users(where: { id: { _eq: $userId } }) {
    id
    role
    isActive
    isStaff
    updatedAt
    managerId
  }
}

subscription UserStatusUpdates($userId: uuid!) {
  users(where: { id: { _eq: $userId } }) {
    id
    name
    role
    isActive
    isStaff
    deactivatedAt
    deactivatedBy
    updatedAt
  }
}

subscription ActiveUsersCount {
  usersAggregate(where: { isActive: { _eq: true } }) {
    aggregate {
      count
    }
  }
}

subscription UserSessionStatus($clerkUserId: String!) {
  users(where: { clerkUserId: { _eq: $clerkUserId } }) {
    id
    role
    isActive
    updatedAt
  }
}

subscription TeamMemberUpdates($managerId: uuid!) {
  users(where: { managerId: { _eq: $managerId } }) {
    id
    name
    role
    isActive
    updatedAt
  }
}

subscription UserPermissionUpdates($userId: uuid!) {
  users(where: { id: { _eq: $userId } }) {
    id
    role
    isActive
    assignedRoles {
      roleId
      assignedRole {
        name
        assignedPermissions {
          permissionId
          grantedPermission {
            action
            description
            relatedResource {
              name
            }
          }
        }
      }
    }
  }
}
