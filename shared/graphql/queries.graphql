# Shared Queries
# Security Classification: MEDIUM - Dashboard and cross-domain data
# SOC2 Compliance: Aggregate data with no PII exposure

query GetDashboardStats {
  # Recent payrolls (using supersededDate as in database schema)
  recent_payrolls: payrolls(
    limit: 5
    order_by: { updatedAt: desc }
    where: { supersededDate: { _is_null: true } }
  ) {
    id
    name
    client {
      id
      name
    }
  }

  # Active users count (using isActive field from database schema)
  active_users_count: usersAggregate(where: { isActive: { _eq: true } }) {
    aggregate {
      count
    }
  }

  # Active clients count (using active field from database schema)
  active_clients_count: clientsAggregate(where: { active: { _eq: true } }) {
    aggregate {
      count
    }
  }

  # Recent payroll dates (using correct field names from database schema)
  recent_payroll_dates: payrollDates(
    limit: 10
    order_by: { adjustedEftDate: desc }
    where: { adjustedEftDate: { _gte: "now()" } }
  ) {
    id
    adjustedEftDate
    processingDate
    payroll {
      id
      name
      client {
        name
      }
    }
  }
}

query GetSystemStats {
  # Total counts for admin dashboard
  total_payrolls: payrollsAggregate {
    aggregate {
      count
    }
  }

  total_clients: clientsAggregate {
    aggregate {
      count
    }
  }

  total_users: usersAggregate {
    aggregate {
      count
    }
  }
}

query GetUpcomingPayrolls {
  payrolls(
    where: { supersededDate: { _is_null: true } }
    order_by: { updatedAt: desc }
    limit: 10
  ) {
    id
    name
    client {
      id
      name
    }
  }
}
