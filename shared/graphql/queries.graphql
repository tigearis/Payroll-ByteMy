# Shared Queries
# Security Classification: MEDIUM - Dashboard and cross-domain data
# SOC2 Compliance: Aggregate data with no PII exposure

query GetDashboardStats {
  # Total clients count
  clients_aggregate: clientsAggregate {
    aggregate {
      count
    }
  }

  # Total payrolls count
  payrolls_aggregate: payrollsAggregate {
    aggregate {
      count
    }
  }

  # Active payrolls (non-superseded)
  active_payrolls: payrollsAggregate(where: { supersededDate: { _is_null: true } }) {
    aggregate {
      count
    }
  }

  # Processing queue (payrolls needing attention - can be refined later)
  processing_queue: payrollsAggregate(
    where: { 
      supersededDate: { _is_null: true }
      status: { _in: ["processing", "pending", "review"] }
    }
  ) {
    aggregate {
      count
    }
  }
}

query GetSystemStats {
  # Total counts for admin dashboard
  total_payrolls: payrollsAggregate {
    aggregate {
      count
    }
  }

  total_clients: clientsAggregate {
    aggregate {
      count
    }
  }

  total_users: usersAggregate {
    aggregate {
      count
    }
  }
}

query GetUpcomingPayrolls($from_date: date!, $limit: Int = 10) {
  payrolls(
    where: { 
      supersededDate: { _is_null: true }
      payrollDates: { adjustedEftDate: { _gte: $from_date } }
    }
    order_by: { payrollDates_aggregate: { min: { adjustedEftDate: asc } } }
    limit: $limit
  ) {
    id
    name
    status
    client {
      id
      name
    }
    payrollDates(
      where: { adjustedEftDate: { _gte: $from_date } }
      order_by: { adjustedEftDate: asc }
      limit: 1
    ) {
      id
      adjustedEftDate
      processingDate
    }
  }
}
